@using Lionk.Core.Component

@if (Component is not null)
{
    <MudCard Elevation="2" Class="hover-card" Style="max-width: 275px; min-height: 230px; padding: 16px; margin: 10px;">
        <MudCardContent>
            <MudText Typo="Typo.h6" Color="Color.Primary" Style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                @Component.InstanceName
            </MudText>
            <MudDivider Light="true" DividerType="DividerType.Middle" />
            <MudGrid>
                <MudItem xs="3">
                    <MudText Typo="Typo.body2">Period:</MudText>
                </MudItem>
                <MudItem xs="6" class="text-right">
                    @if (_editPeriod)
                    {
                        <MudTextField T="double" @bind-Value="_seconde" Variant="Variant.Filled" Label="Period [s]"/>
                    }
                    else
                    {
                        <MudText Typo="Typo.body2">@Component.Period</MudText>
                    }
                </MudItem>

                <MudItem xs="3">
                    <MudButton StartIcon="@_icon" OnClick="ButtonPeriodClick" IconSize="Size.Small"/>
                </MudItem>

                <MudItem xs="6">
                    <MudText Typo="Typo.body2">Cycle Count:</MudText>
                </MudItem>
                <MudItem xs="6" class="text-right">
                    <MudText Typo="Typo.body2">@Component.NbCycle</MudText>
                </MudItem>

            </MudGrid>
        </MudCardContent>
        @if (Component.IsInError)
        {
            <MudCardActions>
                <MudButton Color="Color.Error" Variant="Variant.Outlined" OnClick="ResetComponent">Reset</MudButton>
                <MudTooltip Text="This component is in error please reset it.">
                    <MudIcon Icon="@Icons.Material.Filled.Error" Color="Color.Error" Style="margin-left: 5px;"></MudIcon>
                </MudTooltip>
            </MudCardActions>
        }
    </MudCard>
}

@code {
    /// <summary>
    ///     The cyclic component to display.
    /// </summary>
    [Parameter]
    public ICyclicComponent Component { get; set; } = null!;
    private bool _editPeriod = false;
    private string _icon => _editPeriod ? Icons.Material.Filled.Done : Icons.Material.Filled.Edit;
    private string _adornmentText => _editPeriod ? "Lock edit" : "Edit period";
    private double _seconde
    {
        get => Component.Period.TotalSeconds;
        set => Component.Period = TimeSpan.FromSeconds(value);
    }

    private void ButtonPeriodClick()
    {
        _editPeriod = !_editPeriod;
        InvokeAsync(StateHasChanged);
    }

    private void ResetComponent()
        => Component?.Reset();
}